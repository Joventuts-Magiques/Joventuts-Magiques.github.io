{% assign current_lang = page.lang | default: site.default_lang %}

<nav class="language-selector" role="navigation" aria-label="Language selection">
  <span class="globe-icon" aria-hidden="true">üåê</span>
  <span class="sr-only">Choose language:</span>
  {% for lang in site.languages %}
    {% comment %} Always render as links, JavaScript will handle active state {% endcomment %}
    {% if page.collection == 'games' %}
      {% assign game_name = page.title | slugify %}
      {% assign target_url = "/" %}
      {% for game in site.games %}
        {% if game.lang == lang and game.title == page.title %}
          {% assign target_url = game.url %}
          {% break %}
        {% endif %}
      {% endfor %}
      <a href="{{ target_url }}"
         class="lang-link"
         hreflang="{{ lang }}"
         data-lang="{{ lang }}"
         lang="{{ lang }}"
         aria-label="Switch to {{ site.lang_names[lang] | default: lang }}"
         title="View in {{ site.lang_names[lang] | default: lang }}">
        {{ site.lang_names[lang] | default: lang | upcase }}
      </a>
    {% else %}
      {% comment %} For homepage, always create links including Catalan {% endcomment %}
      {% if lang == site.default_lang %}
        <a href="/"
           class="lang-link"
           hreflang="{{ lang }}"
           data-lang="{{ lang }}"
           lang="{{ lang }}"
           aria-label="Switch to {{ site.lang_names[lang] | default: lang }}"
           title="View in {{ site.lang_names[lang] | default: lang }}">
          {{ site.lang_names[lang] | default: lang | upcase }}
        </a>
      {% else %}
        <a href="/?lang={{ lang }}"
           class="lang-link"
           hreflang="{{ lang }}"
           data-lang="{{ lang }}"
           lang="{{ lang }}"
           aria-label="Switch to {{ site.lang_names[lang] | default: lang }}"
           title="View in {{ site.lang_names[lang] | default: lang }}">
          {{ site.lang_names[lang] | default: lang | upcase }}
        </a>
      {% endif %}
    {% endif %}
    {% unless forloop.last %}<span class="separator" aria-hidden="true">|</span>{% endunless %}
  {% endfor %}
</nav>
